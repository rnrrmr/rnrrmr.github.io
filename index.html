<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="sam_dash.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <title>부동산매물</title>
</head>
<body>
    <!-- main 부분 -->
    <header>
        <h1>
            <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-houses" viewBox="0 0 16 16">
                <path d="M5.793 1a1 1 0 0 1 1.414 0l.647.646a.5.5 0 1 1-.708.708L6.5 1.707 2 6.207V12.5a.5.5 0 0 0 .5.5.5.5 0 0 1 0 1A1.5 1.5 0 0 1 1 12.5V7.207l-.146.147a.5.5 0 0 1-.708-.708L5.793 1Zm3 1a1 1 0 0 1 1.414 0L12 3.793V2.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v3.293l1.854 1.853a.5.5 0 0 1-.708.708L15 8.207V13.5a1.5 1.5 0 0 1-1.5 1.5h-8A1.5 1.5 0 0 1 4 13.5V8.207l-.146.147a.5.5 0 1 1-.708-.708L8.793 2Zm.707.707L5 7.207V13.5a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5V7.207l-4.5-4.5Z"/>
            </svg>
            부동산 매물찾기
            <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-houses" viewBox="0 0 16 16">
                <path d="M5.793 1a1 1 0 0 1 1.414 0l.647.646a.5.5 0 1 1-.708.708L6.5 1.707 2 6.207V12.5a.5.5 0 0 0 .5.5.5.5 0 0 1 0 1A1.5 1.5 0 0 1 1 12.5V7.207l-.146.147a.5.5 0 0 1-.708-.708L5.793 1Zm3 1a1 1 0 0 1 1.414 0L12 3.793V2.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v3.293l1.854 1.853a.5.5 0 0 1-.708.708L15 8.207V13.5a1.5 1.5 0 0 1-1.5 1.5h-8A1.5 1.5 0 0 1 4 13.5V8.207l-.146.147a.5.5 0 1 1-.708-.708L8.793 2Zm.707.707L5 7.207V13.5a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5V7.207l-4.5-4.5Z"/>
            </svg>
        </h1>
    </header>

    <main>
        <div class="px-4 text-center">
            <div class="col-lg-6 mx-auto">
                <p class="lead mb-4">1. 검색할 위치를 지도에서 선택<br>2. 지도 하단의 매물 확인하기 버튼 클릭</p>
                </div>
            </div>
        </div>

        <div class="container">
        <section class="section" id="section-3">
            
            <div id="map" style="width: 100%; height: 600px; position: relative; overflow: hidden; background: rgb(248, 249, 250);">
                <div class="search">
                    <input id="address" type="text" placeholder="검색할 주소" value="">
                    <input id="submit" type="button" value="주소 검색">
                </div>
            </div>
            <code id="snippet" class="snippet"></code>
        </section>
        </div>
        
        <br>
        <div class="container">
            <button type="button" class="btn btn-secondary" id="toggleButton">매물 확인하기</button>
        </div>

        <div class="container">
            <section class="dashboard-content">
                <section id="clickbutton" style="display: none;">
                    <br>
                    <div class="form-check-horizontal">
                        <input class="form-check-input" type="checkbox" value="" id="checklease" checked>
                        <label class="form-check-label" for="checklease">
                            <b>전세</b>
                        </label>
                    </div>
                    <div class="form-check-horizontal">
                        <input class="form-check-input" type="checkbox" value="" id="checkmonth" checked>
                        <label class="form-check-label" for="checkmonth">
                            <b>월세</b>
                        </label>
                    </div>
                    <br>
                    <div class="form-group-horizontal">
                        <label for="sort-select"><b>공급/전용면적 </b></label>
                        <select class="form-select" id="sort-select" defaultValue="default">
                            <option value="default">정렬방법</option>
                            <option value="asc">오름차순</option>
                            <option value="desc">내림차순</option>
                        </select>
                    </div>
                    
                <br><br>
        
                <table id="myTable" class="table caption-top table-secondary table-striped table-hover" width="100%" style="display: none;">
                    <caption><h4> 매물 리스트 </h4></caption>
                    <thead class="table-dark">
                        <tr id="table-header">
                        </tr>
                    </thead>
                    <tbody class="table-group-divider">
                        <!-- csv 데이터 추가 위치 -->
                    </tbody>
                </table>
            </section>
        </div>
        
        
        <!-- 각자 발급받은 Client ID 값 넣기 -->
        <script type="text/javascript" src="https://openapi.map.naver.com/openapi/v3/maps.js?ncpClientId=awp9d8ebup"></script>
        <script type="text/javascript" src="https://oapi.map.naver.com/openapi/v3/maps.js?ncpClientId=awp9d8ebup&submodules=geocoder"></script>
        <script id="code">
           var map = new naver.maps.Map("map", {
                center: new naver.maps.LatLng(37.52914341133875, 126.99554368848251),
                zoom: 15,
                minZoom: 8,
                zoomControl: true,
                zoomControlOptions: {
                    style: naver.maps.ZoomControlStyle.SMALL,
                    position: naver.maps.Position.TOP_RIGHT
                }
            });
            
            var infoWindow = new naver.maps.InfoWindow({anchorSkew: true});
        
        
        
            map.setCursor('pointer');
            function searchCoordinateToAddress(latlng) {
                infoWindow.close();
                naver.maps.Service.reverseGeocode({
                    coords: latlng,
                    orders: [
                        naver.maps.Service.OrderType.ADDR,
                        naver.maps.Service.OrderType.ROAD_ADDR
                    ].join(',')
                }, function(status, response) {
                    if (status === naver.maps.Service.Status.ERROR) {
                        return alert('Something Wrong!');
                    }
            
                    var items = response.v2.results,
                        address = '',
                        htmlAddresses = [];
            
                    for (var i=0, ii=items.length, item, addrType; i<ii; i++) {
                        item = items[i];
                        address = makeAddress(item) || '';
                        addrType = item.name === 'roadaddr' ? '[도로명 주소]' : '[지번 주소]';
            
                        htmlAddresses.push((i+1) +'. '+ addrType +' '+ address);
                    }
            
                    infoWindow.setContent([
                        '<div style="padding:10px;min-width:200px;line-height:150%;">',
                        '<h5 style="margin-top:5px;">검색 지역</h5><br />',
                        htmlAddresses.join('<br />'),
                        '</div>'
                    ].join('\n'));
            
                    infoWindow.open(map, latlng);
                });
            }
            
            function searchAddressToCoordinate(address) {
                naver.maps.Service.geocode({
                    query: address
                }, function(status, response) {
                    if (status === naver.maps.Service.Status.ERROR) {return alert('Something Wrong!');}
            
                    if (response.v2.meta.totalCount === 0) {return alert('totalCount' + response.v2.meta.totalCount);}
            
                    var htmlAddresses = [],
                        item = response.v2.addresses[0],
                        point = new naver.maps.Point(item.x, item.y);
            
                    if (item.roadAddress) {htmlAddresses.push('[도로명 주소] ' + item.roadAddress);}
            
                    if (item.jibunAddress) {htmlAddresses.push('[지번 주소] ' + item.jibunAddress);}
            
                    if (item.englishAddress) {htmlAddresses.push('[영문명 주소] ' + item.englishAddress);}
            
                    infoWindow.setContent([
                        '<div style="padding:10px;min-width:200px;line-height:150%;">',
                        '<h5 style="margin-top:5px;">검색 주소 : '+ address +'</h5><br />',
                        htmlAddresses.join('<br />'),
                        '</div>'
                    ].join('\n'));
            
                    map.setCenter(point);
                    infoWindow.open(map, point);
                });
            }
            
            function initGeocoder() {
                map.addListener('click', function(e) {
                    searchCoordinateToAddress(e.coord);
                });
            
                $('#address').on('keydown', function(e) {
                    var keyCode = e.which;
            
                    if (keyCode === 13) { // Enter Key
                        searchAddressToCoordinate($('#address').val());
                    }
                });
            
                $('#submit').on('click', function(e) {
                    e.preventDefault();
            
                    searchAddressToCoordinate($('#address').val());
                });
            
                searchAddressToCoordinate('보광로 73');
            }
            
            function makeAddress(item) {
                if (!item) {return;}
                
                var name = item.name,
                    region = item.region,
                    land = item.land,
                    isRoadAddress = name === 'roadaddr';
            
                var sido = '', sigugun = '', dongmyun = '', ri = '', rest = '';
            
                if (hasArea(region.area1)) {sido = region.area1.name;}
                if (hasArea(region.area2)) {sigugun = region.area2.name;}
                if (hasArea(region.area3)) {dongmyun = region.area3.name;}
                if (hasArea(region.area4)) {ri = region.area4.name;}
                if (land) {
                    if (hasData(land.number1)) {
                        if (hasData(land.type) && land.type === '2') {
                            rest += '산';
                        }
            
                        rest += land.number1;
            
                        if (hasData(land.number2)) {
                            rest += ('-' + land.number2);
                        }
                    }
            
                    if (isRoadAddress === true) {
                        if (checkLastString(dongmyun, '면')) {
                            ri = land.name;
                        } else {
                            dongmyun = land.name;
                            ri = '';
                        }
            
                        if (hasAddition(land.addition0)) {
                            rest += ' ' + land.addition0.value;
                        }
                    }
                }
            
                return [sido, sigugun, dongmyun, ri, rest].join(' ');
            }
            
            function hasArea(area) {return !!(area && area.name && area.name !== '');}
            
            function hasData(data) {return !!(data && data !== '');}
            
            function checkLastString (word, lastString) {return new RegExp(lastString + '$').test(word);}
            
            function hasAddition (addition) {return !!(addition && addition.value);}
            
            naver.maps.onJSContentLoaded = initGeocoder;
        </script>
        
        <script>
        function addDataToTable() {
            fetch('https://raw.githubusercontent.com/rnrrmr/rnrrmr.github.io/main/real_estate.csv')
            // fetch('https://github.com/rnrrmr/rnrrmr.github.io/blob/main/real_estate.csv') // CSV 파일 가져오기
            // fetch('real_estate.csv')
                .then(response => response.text())
                .then(data => {
                    // CSV 데이터를 파싱
                    const rows = data.trim().split('\n').map(row => row.split(','));

                    // 데이터를 HTML 테이블에 추가
                    const tableHeader = document.querySelector('#table-header');
                    const tableBody = document.querySelector('#myTable tbody');
                    // 첫 번째 행을 thead에 추가
                    const firstRowData = rows[0].map(cell => `<th>${cell}</th>`).join('');
                    tableHeader.innerHTML = firstRowData;
        
                    // 나머지 행을 tbody에 추가
                    for (let i = 1; i < rows.length; i++) {
                        const rowData = rows[i].map(cell => `<td>${cell}</td>`).join('');
                        tableBody.innerHTML += `<tr>${rowData}</tr>`;
                    }
        
                    // 테이블 표시
                    // document.getElementById('myTable').style.display = 'table';
                })
                .catch(error => console.error(error));
        }
        
        // 페이지가 로드된 후 데이터를 추가
        window.addEventListener('load', addDataToTable);

        </script>

    </main>
    <footer>
        <p>&copy;&copy;&copy; 부동산 매물 검색 &copy;&copy;&copy;</p>
    </footer>
    <script src="sam_dash.js"></script>
    <!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm" crossorigin="anonymous"></script> -->
</body>
</html>
